# è€å¸«èªè­‰ç³»çµ±é–‹ç™¼è¨ˆåŠƒ

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

è€å¸«èªè­‰ç³»çµ±å…è¨±è€å¸«ä¸Šå‚³è³‡æ ¼è­‰æ˜ï¼ˆå¦‚è­‰æ›¸ã€åŸ·ç…§ç­‰ï¼‰ï¼Œç”±ç®¡ç†å“¡é€²è¡Œå¯©æ ¸å’Œæ‰¹å‡†ã€‚ç³»çµ±è·Ÿè¹¤èªè­‰ç‹€æ…‹ï¼Œä¸¦åœ¨è€å¸«æª”æ¡ˆä¸­é¡¯ç¤ºèªè­‰å¾½ç« ã€‚

## ğŸ¯ åŠŸèƒ½éœ€æ±‚

### è€å¸«ç«¯åŠŸèƒ½
- ä¸Šå‚³å¤šå€‹èªè­‰æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€JPGã€PNGï¼‰
- æŸ¥çœ‹ä¸Šå‚³çš„èªè­‰æ–‡ä»¶åˆ—è¡¨
- æŸ¥çœ‹èªè­‰å¯©æ ¸ç‹€æ…‹
- ç·¨è¼¯å’Œé‡æ–°ä¸Šå‚³æ–‡ä»¶
- æŸ¥çœ‹èªè­‰è¢«æ‹’çµ•çš„åŸå› 

### ç®¡ç†å“¡ç«¯åŠŸèƒ½
- æŸ¥çœ‹å¾…å¯©æ ¸çš„èªè­‰åˆ—è¡¨
- æŸ¥çœ‹èªè­‰æ–‡ä»¶è©³æƒ…
- æ‰¹å‡†æˆ–æ‹’çµ•èªè­‰
- æ·»åŠ å¯©æ ¸å‚™è¨»
- æŸ¥çœ‹èªè­‰æ­·å²è¨˜éŒ„

### ç³»çµ±åŠŸèƒ½
- è‡ªå‹•é©—è­‰æ–‡ä»¶é¡å‹å’Œå¤§å°
- å®‰å…¨å­˜å„²æ–‡ä»¶åˆ° S3
- è·Ÿè¹¤èªè­‰ç‹€æ…‹è®Šæ›´æ­·å²
- ç™¼é€é€šçŸ¥çµ¦è€å¸«å’Œç®¡ç†å“¡

## ğŸ“Š æ•¸æ“šæ¨¡å‹

### èªè­‰è¡¨ï¼ˆteacher_verificationsï¼‰

```typescript
{
  id: number;                    // ä¸»éµ
  teacherId: number;             // è€å¸« IDï¼ˆå¤–éµï¼‰
  status: 'pending' | 'approved' | 'rejected' | 'expired';
  fileUrl: string;               // æ–‡ä»¶ S3 URL
  fileName: string;              // åŸå§‹æ–‡ä»¶å
  fileSize: number;              // æ–‡ä»¶å¤§å°ï¼ˆå­—ç¯€ï¼‰
  fileType: string;              // MIME é¡å‹
  uploadedAt: Date;              // ä¸Šå‚³æ™‚é–“
  reviewedAt?: Date;             // å¯©æ ¸æ™‚é–“
  reviewedBy?: number;           // å¯©æ ¸è€… IDï¼ˆç®¡ç†å“¡ï¼‰
  reviewNotes?: string;          // å¯©æ ¸å‚™è¨»
  rejectionReason?: string;      // æ‹’çµ•åŸå› 
  expiresAt?: Date;              // éæœŸæ—¥æœŸ
  createdAt: Date;
  updatedAt: Date;
}
```

### èªè­‰é¡å‹è¡¨ï¼ˆverification_typesï¼‰

```typescript
{
  id: number;
  name: string;                  // èªè­‰é¡å‹åç¨±ï¼ˆå¦‚ã€Œç‡Ÿæ¥­åŸ·ç…§ã€ã€ã€ŒåŸ·æ¥­è­‰æ›¸ã€ç­‰ï¼‰
  description: string;
  isRequired: boolean;           // æ˜¯å¦å¿…éœ€
  createdAt: Date;
}
```

### èªè­‰æ­·å²è¡¨ï¼ˆverification_historyï¼‰

```typescript
{
  id: number;
  verificationId: number;        // èªè­‰ IDï¼ˆå¤–éµï¼‰
  status: string;                // ç‹€æ…‹è®Šæ›´
  changedBy: number;             // æ“ä½œè€… ID
  changedAt: Date;
  notes: string;
}
```

## ğŸ› ï¸ æŠ€è¡“æ£§

### å¾Œç«¯
- **æ¡†æ¶**ï¼šExpress.js + TRPC
- **æ•¸æ“šåº«**ï¼šMySQL + Drizzle ORM
- **æ–‡ä»¶å­˜å„²**ï¼šAWS S3
- **é©—è­‰**ï¼šZod

### å‰ç«¯
- **æ¡†æ¶**ï¼šReact + TypeScript
- **UI çµ„ä»¶**ï¼šShadcn/ui
- **æ–‡ä»¶ä¸Šå‚³**ï¼šReact Dropzone
- **ç‹€æ…‹ç®¡ç†**ï¼šReact Query

## ğŸ“ API è¨­è¨ˆ

### è€å¸«ç«¯ API

#### 1. ä¸Šå‚³èªè­‰æ–‡ä»¶
```
POST /api/trpc/teachers.uploadVerification

è«‹æ±‚ï¼š
{
  file: File;                    // æ–‡ä»¶
  verificationTypeId: number;    // èªè­‰é¡å‹ ID
}

éŸ¿æ‡‰ï¼š
{
  id: number;
  status: 'pending';
  fileUrl: string;
  uploadedAt: string;
}
```

#### 2. ç²å–æˆ‘çš„èªè­‰åˆ—è¡¨
```
GET /api/trpc/teachers.getMyVerifications

éŸ¿æ‡‰ï¼š
{
  verifications: [
    {
      id: number;
      status: 'pending' | 'approved' | 'rejected';
      fileName: string;
      uploadedAt: string;
      reviewNotes?: string;
    }
  ]
}
```

#### 3. åˆªé™¤èªè­‰æ–‡ä»¶
```
DELETE /api/trpc/teachers.deleteVerification

è«‹æ±‚ï¼š
{
  verificationId: number;
}

éŸ¿æ‡‰ï¼š
{
  success: boolean;
}
```

### ç®¡ç†å“¡ç«¯ API

#### 1. ç²å–å¾…å¯©æ ¸èªè­‰åˆ—è¡¨
```
GET /api/trpc/superadmin.getPendingVerifications

æŸ¥è©¢åƒæ•¸ï¼š
- page: number
- limit: number
- status: string

éŸ¿æ‡‰ï¼š
{
  verifications: [
    {
      id: number;
      teacherId: number;
      teacherName: string;
      status: 'pending';
      uploadedAt: string;
      fileUrl: string;
    }
  ];
  total: number;
}
```

#### 2. å¯©æ ¸èªè­‰
```
POST /api/trpc/superadmin.reviewVerification

è«‹æ±‚ï¼š
{
  verificationId: number;
  status: 'approved' | 'rejected';
  notes: string;
  rejectionReason?: string;
}

éŸ¿æ‡‰ï¼š
{
  success: boolean;
  verification: { ... }
}
```

#### 3. ç²å–èªè­‰è©³æƒ…
```
GET /api/trpc/superadmin.getVerificationDetail

æŸ¥è©¢åƒæ•¸ï¼š
- verificationId: number

éŸ¿æ‡‰ï¼š
{
  id: number;
  teacherId: number;
  teacherName: string;
  status: string;
  fileUrl: string;
  fileName: string;
  uploadedAt: string;
  reviewNotes?: string;
  history: [ ... ]
}
```

## ğŸ¨ UI çµ„ä»¶è¨­è¨ˆ

### è€å¸«ç«¯çµ„ä»¶

#### 1. èªè­‰ä¸Šå‚³çµ„ä»¶ï¼ˆVerificationUpload.tsxï¼‰
- æ‹–æ‹½ä¸Šå‚³å€åŸŸ
- æ–‡ä»¶é¸æ“‡æŒ‰éˆ•
- æ–‡ä»¶é è¦½
- ä¸Šå‚³é€²åº¦æ¢
- éŒ¯èª¤æç¤º

#### 2. èªè­‰åˆ—è¡¨çµ„ä»¶ï¼ˆVerificationList.tsxï¼‰
- èªè­‰æ–‡ä»¶åˆ—è¡¨
- ç‹€æ…‹å¾½ç« ï¼ˆå¾…å¯©æ ¸ã€å·²æ‰¹å‡†ã€å·²æ‹’çµ•ï¼‰
- æŸ¥çœ‹è©³æƒ…æŒ‰éˆ•
- åˆªé™¤æŒ‰éˆ•
- é‡æ–°ä¸Šå‚³æŒ‰éˆ•

#### 3. èªè­‰è©³æƒ…å°è©±æ¡†ï¼ˆVerificationDetail.tsxï¼‰
- æ–‡ä»¶é è¦½
- å¯©æ ¸ç‹€æ…‹
- å¯©æ ¸å‚™è¨»
- æ‹’çµ•åŸå› ï¼ˆå¦‚æœæœ‰ï¼‰
- ä¸Šå‚³æ™‚é–“

### ç®¡ç†å“¡ç«¯çµ„ä»¶

#### 1. å¾…å¯©æ ¸åˆ—è¡¨ï¼ˆPendingVerificationsList.tsxï¼‰
- è¡¨æ ¼é¡¯ç¤ºå¾…å¯©æ ¸èªè­‰
- æœç´¢å’Œç¯©é¸
- åˆ†é 
- æ‰¹é‡æ“ä½œ

#### 2. å¯©æ ¸è©³æƒ…é é¢ï¼ˆVerificationReview.tsxï¼‰
- æ–‡ä»¶é è¦½ï¼ˆæ”¯æŒ PDFã€åœ–ç‰‡ï¼‰
- è€å¸«ä¿¡æ¯
- èªè­‰é¡å‹
- å¯©æ ¸è¡¨å–®ï¼ˆæ‰¹å‡†/æ‹’çµ•ï¼‰
- å¯©æ ¸å‚™è¨»è¼¸å…¥

#### 3. èªè­‰çµ±è¨ˆé¢æ¿ï¼ˆVerificationStats.tsxï¼‰
- å¾…å¯©æ ¸æ•¸é‡
- å·²æ‰¹å‡†æ•¸é‡
- å·²æ‹’çµ•æ•¸é‡
- å¹³å‡å¯©æ ¸æ™‚é–“

## ğŸ“‚ æ–‡ä»¶çµæ§‹

```
soulguide/
â”œâ”€â”€ drizzle/
â”‚   â””â”€â”€ schema.ts               # æ·»åŠ èªè­‰ç›¸é—œè¡¨
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ routers.ts              # æ·»åŠ èªè­‰ API è·¯ç”±
â”‚   â””â”€â”€ db.ts                   # æ·»åŠ èªè­‰æ•¸æ“šåº«æ“ä½œå‡½æ•¸
â”œâ”€â”€ client/src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ teacher/
â”‚   â”‚   â”‚   â”œâ”€â”€ VerificationUpload.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VerificationList.tsx
â”‚   â”‚   â”‚   â””â”€â”€ VerificationDetail.tsx
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ PendingVerificationsList.tsx
â”‚   â”‚       â”œâ”€â”€ VerificationReview.tsx
â”‚   â”‚       â””â”€â”€ VerificationStats.tsx
â”‚   â””â”€â”€ pages/
â”‚       â”œâ”€â”€ teacher/
â”‚       â”‚   â””â”€â”€ Verification.tsx
â”‚       â””â”€â”€ admin/
â”‚           â””â”€â”€ VerificationManagement.tsx
```

## ğŸ”„ å·¥ä½œæµç¨‹

### è€å¸«èªè­‰æµç¨‹

```
è€å¸«ä¸Šå‚³æ–‡ä»¶
    â†“
ç³»çµ±é©—è­‰æ–‡ä»¶
    â†“
æ–‡ä»¶å­˜å„²åˆ° S3
    â†“
èªè­‰ç‹€æ…‹è¨­ç‚º 'pending'
    â†“
ç®¡ç†å“¡æ”¶åˆ°é€šçŸ¥
    â†“
è€å¸«å¯ä»¥æŸ¥çœ‹ç‹€æ…‹
```

### ç®¡ç†å“¡å¯©æ ¸æµç¨‹

```
ç®¡ç†å“¡æŸ¥çœ‹å¾…å¯©æ ¸åˆ—è¡¨
    â†“
é»æ“Šèªè­‰é€²è¡Œè©³ç´°å¯©æŸ¥
    â†“
æŸ¥çœ‹æ–‡ä»¶å’Œè€å¸«ä¿¡æ¯
    â†“
æ‰¹å‡†æˆ–æ‹’çµ•
    â†“
æ·»åŠ å¯©æ ¸å‚™è¨»
    â†“
è€å¸«æ”¶åˆ°é€šçŸ¥
    â†“
èªè­‰ç‹€æ…‹æ›´æ–°
```

## âœ… é©—æ”¶æ¨™æº–

### åŠŸèƒ½é©—æ”¶
- [ ] è€å¸«å¯ä»¥æˆåŠŸä¸Šå‚³èªè­‰æ–‡ä»¶
- [ ] ç³»çµ±é©—è­‰æ–‡ä»¶é¡å‹å’Œå¤§å°
- [ ] æ–‡ä»¶å®‰å…¨å­˜å„²åˆ° S3
- [ ] è€å¸«å¯ä»¥æŸ¥çœ‹ä¸Šå‚³çš„èªè­‰åˆ—è¡¨
- [ ] ç®¡ç†å“¡å¯ä»¥æŸ¥çœ‹å¾…å¯©æ ¸èªè­‰
- [ ] ç®¡ç†å“¡å¯ä»¥æ‰¹å‡†æˆ–æ‹’çµ•èªè­‰
- [ ] è€å¸«æ”¶åˆ°å¯©æ ¸çµæœé€šçŸ¥
- [ ] èªè­‰ç‹€æ…‹æ­£ç¢ºé¡¯ç¤º

### æ€§èƒ½é©—æ”¶
- [ ] æ–‡ä»¶ä¸Šå‚³é€Ÿåº¦ < 5 ç§’ï¼ˆ10MB æ–‡ä»¶ï¼‰
- [ ] åˆ—è¡¨åŠ è¼‰æ™‚é–“ < 1 ç§’
- [ ] å¯©æ ¸æ“ä½œéŸ¿æ‡‰æ™‚é–“ < 500ms

### å®‰å…¨é©—æ”¶
- [ ] åªæœ‰è€å¸«å¯ä»¥ä¸Šå‚³è‡ªå·±çš„èªè­‰
- [ ] åªæœ‰ç®¡ç†å“¡å¯ä»¥å¯©æ ¸èªè­‰
- [ ] æ–‡ä»¶å­˜å„²å®‰å…¨ï¼ˆåŠ å¯†ã€è¨ªå•æ§åˆ¶ï¼‰
- [ ] é˜²æ­¢æ–‡ä»¶ä¸Šå‚³æ¼æ´

## ğŸ“… é–‹ç™¼æ™‚é–“è¡¨

| éšæ®µ | ä»»å‹™ | é è¨ˆæ™‚é–“ |
|------|------|---------|
| 1 | æ•¸æ“šåº«è¨­è¨ˆå’Œé·ç§» | 1 å°æ™‚ |
| 2 | å¾Œç«¯ API é–‹ç™¼ | 2 å°æ™‚ |
| 3 | å‰ç«¯è€å¸«ä¸Šå‚³çµ„ä»¶ | 1.5 å°æ™‚ |
| 4 | å‰ç«¯ç®¡ç†å“¡å¯©æ ¸ç•Œé¢ | 2 å°æ™‚ |
| 5 | é›†æˆå’Œæ¸¬è©¦ | 1.5 å°æ™‚ |
| **ç¸½è¨ˆ** | | **8 å°æ™‚** |

## ğŸš€ é–‹ç™¼æ­¥é©Ÿ

### ç¬¬ 1 æ­¥ï¼šæ•¸æ“šåº«è¨­è¨ˆ
- å‰µå»ºèªè­‰è¡¨
- å‰µå»ºèªè­‰é¡å‹è¡¨
- å‰µå»ºèªè­‰æ­·å²è¡¨
- é‹è¡Œé·ç§»

### ç¬¬ 2 æ­¥ï¼šå¾Œç«¯é–‹ç™¼
- å¯¦ç¾æ–‡ä»¶ä¸Šå‚³ API
- å¯¦ç¾èªè­‰æŸ¥è©¢ API
- å¯¦ç¾èªè­‰å¯©æ ¸ API
- æ·»åŠ æ•¸æ“šé©—è­‰

### ç¬¬ 3 æ­¥ï¼šå‰ç«¯é–‹ç™¼
- å¯¦ç¾è€å¸«ä¸Šå‚³çµ„ä»¶
- å¯¦ç¾è€å¸«èªè­‰åˆ—è¡¨
- å¯¦ç¾ç®¡ç†å“¡å¯©æ ¸ç•Œé¢
- æ·»åŠ ç‹€æ…‹é¡¯ç¤º

### ç¬¬ 4 æ­¥ï¼šæ¸¬è©¦å’Œå„ªåŒ–
- åŠŸèƒ½æ¸¬è©¦
- æ€§èƒ½æ¸¬è©¦
- å®‰å…¨æ¸¬è©¦
- ç”¨æˆ¶é«”é©—å„ªåŒ–

---

**æº–å‚™é–‹å§‹é–‹ç™¼äº†å—ï¼Ÿ** æˆ‘ç¾åœ¨é–‹å§‹ç¬¬ 1 æ­¥ï¼šæ•¸æ“šåº«è¨­è¨ˆã€‚
